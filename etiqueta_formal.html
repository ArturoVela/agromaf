<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etiqueta Formal - Generador de Etiquetas</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/etiqueta.css">
</head>
<body class="bg-gray-100 text-gray-800">
    <div id="sidebar-container"></div>

    <main class="main-content">
        <div id="form-section" class="container mx-auto p-4 sm:p-8 max-w-2xl">
        <div class="bg-white rounded-2xl shadow-lg p-6 sm:p-8">
            <img src="img/Logoagro.jpg" alt="Logo Agromaf" class="h-16 w-auto mb-6">
            <h1 class="text-2xl sm:text-3xl font-bold mb-2">Etiqueta Formal</h1>
            <p class="text-gray-600 mb-6">Completa los siguientes campos para crear la etiqueta formal.</p>

            <form id="formal-form" class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="nro_factura" class="block text-sm font-medium text-gray-700 mb-1 required-label">Nro Factura</label>
                        <input type="text" id="nro_factura" name="nro_factura" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition" required>
                    </div>
                    <div>
                        <label for="nro_orden" class="block text-sm font-medium text-gray-700 mb-1 required-label">Nro Orden</label>
                        <input type="text" id="nro_orden" name="nro_orden" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition" required>
                    </div>
                </div>

                <div>
                    <label for="nombre" class="block text-sm font-medium text-gray-700 mb-1 required-label">Nombre Completo</label>
                    <input type="text" id="nombre" name="nombre" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition" required>
                </div>

                <div>
                    <label for="dni" class="block text-sm font-medium text-gray-700 mb-1 required-label">DNI / Documento de Identidad</label>
                    <input type="text" id="dni" name="dni" inputmode="numeric" pattern="\\d{11}" maxlength="11" title="Ingrese exactamente 11 dígitos numéricos" oninput="this.value = this.value.replace(/\D/g, '').slice(0,11);" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition" required>
                </div>

                <div>
                    <label for="direccion" class="block text-sm font-medium text-gray-700 mb-1 required-label">Dirección de Entrega</label>
                    <input type="text" id="direccion" name="direccion" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition" required>
                </div>
                <div>
                    <label for="direccion" class="block text-sm font-medium text-gray-700 mb-1 required-label">Dirección de Entrega</label>
                    <input type="text" id="direccion" name="direccion" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition" required>
                </div>

                <div>
                    <label for="contenido" class="block text-sm font-medium text-gray-700 mb-1 required-label">Contenido del Bulto</label>
                    <input type="text" id="contenido" name="contenido" placeholder="Ej: Motosierra, FS, BR..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition" required>
                </div>

                <!-- Agrupamos Celular, Peso y Bultos en una sola fila (Celular primero) -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div>
                        <label for="celular" class="block text-sm font-medium text-gray-700 mb-1 required-label">Número de Celular</label>
                        <input type="tel" id="celular" name="celular" inputmode="numeric" pattern="\d{9}" maxlength="9" required title="Ingrese exactamente 9 dígitos numéricos" oninput="this.value = this.value.replace(/\D/g, '').slice(0,9);" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition">
                    </div>

                    <div>
                        <label for="peso" class="block text-sm font-medium text-gray-700 mb-1 required-label">Peso (kg)</label>
                        <input type="number" id="peso" name="peso" step="0.1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition" required>
                    </div>

                    <div>
                        <label for="bultos" class="block text-sm font-medium text-gray-700 mb-1 required-label">Número de Bultos</label>
                        <input type="number" id="bultos" name="bultos" min="1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition" required>
                    </div>
                </div>

                <button type="submit" class="w-full bg-orange-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-transform transform hover:scale-105" style="background-color: #f97316; border-color: #f97316;">Generar Etiqueta Formal</button>
            </form>
        </div>
        </div>

        <div id="label-preview" class="hidden">
        <div class="container mx-auto p-4 text-center no-print">
             <h2 class="text-2xl font-bold mb-4">Vista Previa de la Etiqueta Formal</h2>
             <p class="text-gray-600 mb-4">Usa el botón de imprimir para generar el PDF o enviarlo a tu impresora.</p>
            <button onclick="window.print()" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition mr-2">Imprimir</button>
            <button onclick="editCurrentLabel()" class="text-white font-bold py-2 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 transition mr-2" style="background-color: #f97316; border-color: #f97316;" onmouseover="this.style.backgroundColor='#ea580c'" onmouseout="this.style.backgroundColor='#f97316'">Editar</button>
            <button onclick="createNewLabel()" class="bg-gray-300 text-gray-800 font-bold py-2 px-6 rounded-lg hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition">Crear Nueva Etiqueta</button>
        </div>

        <div id="label-container" class="bg-white shadow-lg"></div>
        </div>
    </main>

    <script src="sidebar.js"></script>
    <script>
        document.getElementById('formal-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const nombre = document.getElementById('nombre').value.trim();
            const direccion = document.getElementById('direccion').value.trim();
            const dni = document.getElementById('dni').value.trim();
            const contenido = document.getElementById('contenido').value.trim();
            const nro_factura = document.getElementById('nro_factura').value.trim();
            const nro_orden = document.getElementById('nro_orden').value.trim();
            const peso = document.getElementById('peso').value.trim();
            const celular = document.getElementById('celular').value.trim();
            const bultos = document.getElementById('bultos').value.trim();

            // Validaciones básicas
            if (!nro_factura) {
                alert('Ingrese Nro Factura.');
                document.getElementById('nro_factura').focus();
                return;
            }
            if (!nro_orden) {
                alert('Ingrese Nro Orden.');
                document.getElementById('nro_orden').focus();
                return;
            }
            if (!nombre) {
                alert('Ingrese el nombre completo.');
                document.getElementById('nombre').focus();
                return;
            }
            // Validación: DNI debe tener exactamente 11 dígitos
            if (!/^\d{11}$/.test(dni)) {
                alert('El DNI debe contener exactamente 11 dígitos numéricos.');
                document.getElementById('dni').focus();
                return;
            }
            if (!direccion) {
                alert('Ingrese la dirección de entrega.');
                document.getElementById('direccion').focus();
                return;
            }
            if (!/^[0-9]+(\.[0-9]+)?$/.test(peso)) {
                alert('Ingrese el peso válido.');
                document.getElementById('peso').focus();
                return;
            }
            if (!/^\d{9}$/.test(celular)) {
                alert('El número de celular debe contener exactamente 9 dígitos numéricos.');
                document.getElementById('celular').focus();
                return;
            }
            // Validación: DNI debe tener exactamente 11 dígitos
            if (!/^\d{11}$/.test(dni)) {
                alert('El DNI debe contener exactamente 11 dígitos numéricos.');
                document.getElementById('dni').focus();
                return;
            }
            if (!bultos || parseInt(bultos, 10) < 1) {
                alert('Ingrese el número de bultos (>=1).');
                document.getElementById('bultos').focus();
                return;
            }

            const labelContainer = document.getElementById('label-container');

            // Vista previa: mostrar primero Nro Factura / Nro Orden, luego datos del destinatario
            labelContainer.innerHTML = `
                <div class="flex justify-between items-start border-b-2 border-black pb-4">
                    <img src="img/Logoagro.jpg" alt="Logo Agromaf" class="h-16 w-auto">
                    <div class="text-right">
                        <p class="text-sm font-bold">Fecha: ${new Date().toLocaleDateString('es-ES')}</p>
                    </div>
                </div>

                <div class="py-4 space-y-3 text-lg">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm text-gray-500 uppercase font-semibold">NRO FACTURA</p>
                            <p class="font-semibold text-lg">${nro_factura}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500 uppercase font-semibold">NRO ORDEN</p>
                            <p class="font-semibold text-lg">${nro_orden}</p>
                        </div>
                    </div>

                    <div>
                        <p class="text-sm text-gray-500 uppercase font-semibold">DESTINATARIO</p>
                        <p class="font-bold text-3xl">${nombre}</p>
                        <p class="text-base">DNI: ${dni}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 uppercase font-semibold">DIRECCIÓN</p>
                        <p class="break-words text-lg font-bold">${direccion}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 uppercase font-semibold">CONTENIDO</p>
                        <p class="font-semibold break-words text-lg">${contenido}</p>
                    </div>
                </div>

                <div class="border-t-2 border-black pt-4 grid grid-cols-3 gap-4 text-left">
                    <div>
                        <p class="text-sm text-gray-500 uppercase font-semibold">CELULAR</p>
                        <p class="font-semibold text-lg">${celular || '&mdash;'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 uppercase font-semibold">PESO</p>
                        <p class="font-semibold text-lg">${peso ? peso + ' kg' : '&mdash;'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 uppercase font-semibold">BULTOS</p>
                        <p class="font-semibold text-lg">${bultos || '&mdash;'}</p>
                    </div>
                </div>
            `;

            document.getElementById('form-section').classList.add('hidden');
            document.getElementById('label-preview').classList.remove('hidden');
        });

        function createNewLabel() {
            document.getElementById('form-section').classList.remove('hidden');
            document.getElementById('label-preview').classList.add('hidden');
            document.getElementById('formal-form').reset();
        }

        function editCurrentLabel() {
            const labelContainer = document.getElementById('label-container');

            // Extraer valores desde la vista previa actualizada por estructura
            const fontSemibold = labelContainer.querySelectorAll('.font-semibold.text-lg');
            const nro_factura_val = fontSemibold[0] ? fontSemibold[0].textContent : '';
            const nro_orden_val = fontSemibold[1] ? fontSemibold[1].textContent : '';

            const nombreEl = labelContainer.querySelector('.font-bold.text-3xl');
            const nombre = nombreEl ? nombreEl.textContent : '';
            const dniEl = labelContainer.querySelector('.text-base');
            const dni = dniEl ? dniEl.textContent.replace('DNI: ', '') : '';
            const direccionEl = labelContainer.querySelector('.break-words.text-lg');
            const direccion = direccionEl ? direccionEl.textContent : '';
            const contenidoEl = labelContainer.querySelector('.font-semibold.break-words.text-lg');
            const contenido = contenidoEl ? contenidoEl.textContent : '';

            // recoger celular, peso, bultos desde el grid final (ahora celular primero)
            const gridItems = labelContainer.querySelectorAll('.border-t-2.border-black.pt-4.grid > div');
            const celular = gridItems[0] ? gridItems[0].querySelector('.font-semibold.text-lg').textContent : '';
            const peso = gridItems[1] ? gridItems[1].querySelector('.font-semibold.text-lg').textContent.replace(' kg','') : '';
            const bultos = gridItems[2] ? gridItems[2].querySelector('.font-semibold.text-lg').textContent : '';

            document.getElementById('nro_factura').value = nro_factura_val || '';
            document.getElementById('nro_orden').value = nro_orden_val || '';
            document.getElementById('nombre').value = nombre || '';
            document.getElementById('dni').value = dni || '';
            document.getElementById('direccion').value = direccion || '';
            document.getElementById('contenido').value = contenido !== 'No especificado' ? contenido : '';
            document.getElementById('peso').value = peso !== '—' ? peso : '';
            document.getElementById('celular').value = celular !== '—' ? celular : '';
            document.getElementById('bultos').value = bultos !== '—' ? bultos : '';

            document.getElementById('form-section').classList.remove('hidden');
            document.getElementById('label-preview').classList.add('hidden');
        }
    </script>
</body>
</html>